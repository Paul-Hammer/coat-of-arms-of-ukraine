import { NextRequest, NextResponse } from "next/server";
import { ImageResponse } from "next/og";
import { validateGetImageRequest } from "@/lib/utils";

export async function GET(req: NextRequest) {
  const validationResult = validateGetImageRequest(req);
  if (!validationResult.success) {
    return NextResponse.json(validationResult.errors);
  }
  const { fill, size } = validationResult.data;
  return new ImageResponse(
    (
      <svg
        width={243 * size}
        height={size * 400}
        xmlns="http://www.w3.org/2000/svg"
      >
        <path
          fill-rule="evenodd"
          clip-rule="evenodd"
          d="M64.8871 301.449C64.8871 301.449 64.8871 302.365 64.8871 302.772H86.3472V301.043C86.2932 300.57 86.2932 300.092 86.3472 299.619C86.6072 293.992 87.2191 288.388 88.1772 282.838C89.3265 271.162 92.8638 259.848 98.5669 249.595C104.27 239.343 112.019 230.373 121.333 223.24C139.359 238.636 151.237 260.01 154.793 283.447C155.706 289.004 156.318 294.607 156.625 300.23V302.772H178.084V301.449C178.216 272.419 167.31 244.425 147.573 223.137C136.294 196.087 131.79 166.69 134.454 137.503C135.673 109.433 136.589 73.1241 137.707 44.9517C138.798 29.7453 133.992 14.704 124.283 2.94869C123.312 1.88401 122.257 0.898187 121.13 0C121.13 0 118.587 2.23744 117.977 2.94869C108.254 14.7405 103.413 29.8067 104.451 45.0539C105.57 73.1241 106.484 109.433 107.705 137.605C110.702 166.791 106.223 196.262 94.6864 223.24C75.1337 244.672 64.4796 272.747 64.8871 301.754V301.449ZM242.768 40.1731H241.344L238.496 41.6978C225.911 49.3317 214.786 59.146 205.645 70.6837C187.873 93.5181 177.477 121.225 175.846 150.114C174.524 165.776 172.287 181.337 170.558 196.999C169.642 204.933 168.828 212.866 168.015 220.798C171.459 220.249 174.984 220.535 178.294 221.633C181.603 222.73 184.6 224.607 187.035 227.104C190.48 230.062 192.631 234.249 193.03 238.772C193.43 243.295 192.044 247.794 189.17 251.31C186.031 254.621 182.351 257.374 178.288 259.446C180.555 265.869 182.29 272.469 183.474 279.177H184.695C192.37 276.929 199.214 272.471 204.369 266.357C209.524 260.244 212.762 252.745 213.681 244.801C214.43 237.104 212.901 229.358 209.285 222.523C205.669 215.689 200.123 210.066 193.34 206.357C192.3 205.946 191.439 205.178 190.917 204.189C190.395 203.201 190.243 202.057 190.492 200.966C192.628 183.575 194.866 166.184 196.493 148.792C197.972 132.897 202.387 117.413 209.51 103.127C213.336 96.1192 217.547 89.3295 222.122 82.7866V311.009H139.742V329.419H153.574C150.465 344.863 142.815 359.028 131.606 370.1V307.653C132.593 303.951 134.605 300.602 137.412 297.992C140.219 295.384 143.706 293.62 147.471 292.907L149.099 292.397C149.099 289.448 148.386 287.008 148.284 285.787C147.774 281.847 147.028 277.941 146.047 274.092L141.369 275.616C134.034 279.189 127.196 283.702 121.029 289.041C114.834 283.737 108 279.227 100.688 275.616L96.7209 274.092C95.7248 278.074 94.9771 282.117 94.4834 286.195C94.4834 287.414 93.9752 289.856 93.67 292.805L95.2969 293.313C99.0065 294.02 102.446 295.746 105.23 298.296C108.013 300.846 110.033 304.122 111.061 307.755V370.303C99.9952 359.139 92.4008 345.009 89.1951 329.622H103.027V311.009H20.5444V82.4813C20.5444 82.4813 29.7994 96.1089 33.1555 102.821C40.2008 117.138 44.6114 132.607 46.1741 148.487C47.7003 165.878 49.9378 183.27 52.073 200.661C52.349 201.74 52.2234 202.882 51.7181 203.874C51.2127 204.867 50.3628 205.641 49.3273 206.051C42.5069 209.72 36.9323 215.334 33.3103 222.179C29.6884 229.025 28.1826 236.793 28.9859 244.495C29.9045 252.44 33.1424 259.938 38.2978 266.052C43.4533 272.165 50.297 276.624 57.9718 278.872H59.0905C60.2019 271.958 61.9033 265.154 64.1758 258.53C60.1449 256.405 56.4733 253.66 53.2939 250.394C50.4562 246.857 49.1038 242.356 49.5215 237.84C49.9378 233.324 52.0934 229.146 55.5313 226.188C57.9338 223.678 60.9117 221.791 64.208 220.693C67.5042 219.594 71.0196 219.315 74.4473 219.884C73.4308 213.069 73.4308 205.035 72.1091 197.102C70.3799 181.44 68.0402 165.878 66.8207 150.216C65.2099 121.29 54.8128 93.5458 37.0214 70.6837C27.8847 59.1796 16.8012 49.3682 4.27186 41.6978L1.32317 40.1731H0V329.419H67.1245C70.7888 344.292 77.4967 358.245 86.8277 370.393C96.1586 382.543 107.908 392.625 121.333 400C134.938 392.832 146.841 382.818 156.23 370.639C165.618 358.458 172.275 344.4 175.745 329.419H242.768V40.1731Z"
          fill={fill}
        />
      </svg>
    ),
    {
      width: 243 * size,
      height: 400 * size,
    },
  );
}
